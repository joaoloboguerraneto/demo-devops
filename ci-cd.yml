deploy:
  runs-on: ubuntu-latest
  needs: build

  steps:
  - name: Checkout code
    uses: actions/checkout@v3

  - name: Set up kubectl
    uses: azure/setup-kubectl@v3
    with:
      version: 'v1.29.2'

  - name: Configure kubeconfig
    run: |
      echo "${{ secrets.KUBECONFIG }}" | base64 --decode > $HOME/.kube/config
      chmod 600 $HOME/.kube/config

  - name: Deploy to Kubernetes
    run: |
      kubectl apply -f k8s-deployment.yml
